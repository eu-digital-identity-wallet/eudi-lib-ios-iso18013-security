    /*
Copyright (c) 2023 European Commission

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

import Testing
import Foundation
@testable import MdocDataModel18013
@testable import MdocSecurity18013

@Suite("MSO Validation Tests")
struct MsoValidationTests {

    @Test("MSO verifications run successfully")
    func testMsoValidations() async throws {
        let strData = "o2d2ZXJzaW9uYzEuMGlkb2N1bWVudHOBo2dkb2NUeXBld2V1LmV1cm9wYS5lYy5ldWRpLnBpZC4xbGlzc3VlclNpZ25lZKJqbmFtZVNwYWNlc6F3ZXUuZXVyb3BhLmVjLmV1ZGkucGlkLjGYIdgYWIqkZnJhbmRvbVhAQ+yIFrfJ9ZSxMB2LvvdftNSkF6GCtusdt7OSP313dS/fn8QPex3CZ0NvDDV1tuhV89Gjs5OB5emhkY70BMYodGhkaWdlc3RJRBgsbGVsZW1lbnRWYWx1ZWlBTkRFUlNTT05xZWxlbWVudElkZW50aWZpZXJrZmFtaWx5X25hbWXYGFiDpGZyYW5kb21YQFlsFOVzrWMRKJ1aoUumWhWKJBGtqhegT73iD6MIOF60vZNbpaqRQEotenfJ5WoxAFdbMjNtcg+Dfho5zU84IYBoZGlnZXN0SUQYNGxlbGVtZW50VmFsdWVjSkFOcWVsZW1lbnRJZGVudGlmaWVyamdpdmVuX25hbWXYGFiMpGZyYW5kb21YQJz+aFDAmPoHryEH7iJXUe5E/HMSuMF9M11aMfhZvaK4cDQBVDzNHLlD3GEYTbWF84mpiYoxx7vWMvzkZGCNtZZoZGlnZXN0SUQDbGVsZW1lbnRWYWx1ZdkD7GoxOTg1LTAzLTMwcWVsZW1lbnRJZGVudGlmaWVyamJpcnRoX2RhdGXYGFiBpGZyYW5kb21YQJEuJtnmYc+Pt9ihrgbbqTKgGfhcEFeDtljhzgIk9hFC4NLgglDIQe4QwvWTNqfRNUL7Am4A+owYd97+ZuEFJadoZGlnZXN0SUQYKGxlbGVtZW50VmFsdWX1cWVsZW1lbnRJZGVudGlmaWVya2FnZV9vdmVyXzE42BhYgaRmcmFuZG9tWEDs7aCcWKE1Gt5ESbFRN2g0L+3XHpDG/2WfKXeXiK7uZ6f7zXu8jm2GyrjVlqp2F1e3jqNDZjFaY9G8lZVPt/QxaGRpZ2VzdElEGCBsZWxlbWVudFZhbHVl9XFlbGVtZW50SWRlbnRpZmllcmthZ2Vfb3Zlcl8xNdgYWIGkZnJhbmRvbVhA/dhOkQeqMm2RjXigwB9aAtbrfos2PX8Ery6LCE1vTBbslnhC1cqdgzu6scjm1qpZzdhl+UQYy5wCXFKuApnawmhkaWdlc3RJRBhobGVsZW1lbnRWYWx1ZfVx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ZWxlbWVudElkZW50aWZpZXJwcmVzaWRlbnRfY291bnRyedgYWIakZnJhbmRvbVhAxNRWWS/ed9k/pntsKwpOHjzwa33n9to/Ame2kBOviYuCHvdoapdQDaDTKeY6eRDcIbLR0fyskXw8dgW7opOyh2hkaWdlc3RJRBgubGVsZW1lbnRWYWx1ZWJTRXFlbGVtZW50SWRlbnRpZmllcm5yZXNpZGVudF9zdGF0ZdgYWI6kZnJhbmRvbVhA+x9KKrNL6ThdX03BsPvrniKFFL7BGHPyTKBC2T3/7PamJ7WGTWCuwwlvzsGAKuzblHclrK5hJmGbP+pPY7pR0mhkaWdlc3RJRBgebGVsZW1lbnRWYWx1ZWtLQVRSSU5FSE9MTXFlbGVtZW50SWRlbnRpZmllcm1yZXNpZGVudF9jaXR52BhYjqRmcmFuZG9tWECMp2Fa7FsI8HnCpeWViPm1pHF2RTKEUQl0S73VKjh4ACw2uUfmXCpfl3JYM73jK6NPcSBfx+ecJr3fyxp7lLYcaGRpZ2VzdElEAmxlbGVtZW50VmFsdWVlNjQxMzNxZWxlbWVudElkZW50aWZpZXJ0cmVzaWRlbnRfcG9zdGFsX2NvZGXYGFiRpGZyYW5kb21YQNgZgbaxnJYhnxYO+pVqbARftZScBwcmwBT3nJr5FlgcFF8P6GjyFQo5RLqEHc+/rnUtmxPVyw7L1ZTdfeYEhX5oZGlnZXN0SUQYJGxlbGVtZW50VmFsdWVsRk9SVFVOQUdBVEFOcWVsZW1lbnRJZGVudGlmaWVyb3Jlc2lkZW50X3N0cmVldNgYWI2kZnJhbmRvbVhAcyFlqWoAAamuLlCB8EUxNNP4Udo0G8zuH/9RBhgMDz5M4ok6q6eJkKxD//rMkNK92EGDsOBwulHLqNDbWz1PEWhkaWdlc3RJRBgwbGVsZW1lbnRWYWx1ZWIxMnFlbGVtZW50SWRlbnRpZmllcnVyZXNpZGVudF9ob3VzZV9udW1iZXLYGFh8pGZyYW5kb21YQNvQlVnMXiLU1kxuf0qM09nYDBezf4HciOYP6aW5L+vLVqKpj+tfR4Fqig+gNshRNUW+vqLzzkxvjydkaGGDCrVoZGlnZXN0SUQYJ2xlbGVtZW50VmFsdWUBcWVsZW1lbnRJZGVudGlmaWVyZmdlbmRlctgYWIKkZnJhbmRvbVhA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"
        let base64Data = try #require(Data(base64URLEncoded: strData))
		let dr = try DeviceResponse(data: [UInt8](base64Data))
		let iss = try #require(dr.documents?.first?.issuerSigned)
        do {
            try iss.validateMSO(docType: "eu.europa.ec.eudi.pid.1", trustedIACA: [])
        } catch {
            // Expected to fail due to missing/invalid certificates in x5chain
            switch error {
            case .multipleErrors(let errors):
                errors.forEach { print($0.errorDescription ?? "Unknown error") }
            default: print(error.errorDescription ?? "Unknown error") }
        }
    }


}
